<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Classroom - IIIT Bhubaneswar</title>
    <link rel="stylesheet" href="f_current.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
<header class="mobile-header">
    <button id="menuToggle" aria-label="Toggle menu"><i class="fas fa-bars"></i></button>
    <h2>Classroom</h2>
</header>

<div class="container">
    <aside class="sidebar" id="sidebar">
        <a href="d_home.html" class="back-btn-sidebar">
            <i class="fas fa-arrow-left"></i>
            Back to Dashboard
        </a>
        <nav class="nav-options">
            <button class="side-btn"><i class="fas fa-bullhorn"></i> Notice Board</button>
            <button class="side-btn"><i class="fas fa-user-graduate"></i> Student Details</button>
            <button class="side-btn"><i class="fas fa-chalkboard-teacher"></i> Faculty Details</button>
            <button class="side-btn"><i class="fas fa-calendar-alt"></i> Timetable</button>
            <button class="side-btn"><i class="fas fa-comment-alt"></i> Grievance</button>
            <button class="side-btn"><i class="fas fa-chalkboard-teacher"></i> Teaching Currently</button>
        </nav>
        <div class="logo-container">
            <img src="IIIT LOGO 3.svg" alt="IIIT Logo" class="logo"/>
            <p class="footer-text">IIIT Student Management System</p>
            <a href="https://www.iiit-bh.ac.in" class="footer-link" target="_blank" rel="noopener">www.iiit-bh.ac.in</a>
        </div>
    </aside>

    <main class="main-content">
        <div class="header-line">
            <h1><i class="fas fa-chalkboard-teacher"></i> Classroom Management</h1>
            <hr />
        </div>

        <!-- Course List Section -->
        <section class="section-container">
            <h2>Assigned Courses</h2>
            <div class="table-container">
                <table class="course-table">
                    <thead>
                        <tr>
                            <th>Course Code</th>
                            <th>Course Name</th>
                            <th>Semester</th>
                            <th>Branch</th>
                            <th>Student Strength</th>
                            <th>Room No</th>
                        </tr>
                    </thead>
                    <tbody id="courseTableBody"></tbody>
                </table>
            </div>
        </section>

        <!-- Attendance Section -->
        <section class="section-container">
            <h2>Take Attendance</h2>
            <div class="form-container">
                <form id="attendanceForm">
                    <div class="form-group">
                        <label for="courseSelect">Course</label>
                        <select id="courseSelect" required>
                            <option value="">Select Course</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="semesterSelect">Semester</label>
                        <select id="semesterSelect" required>
                            <option value="">Select Semester</option>
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                            <option value="6">6</option>
                            <option value="7">7</option>
                            <option value="8">8</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="branchSelect">Branch</label>
                        <select id="branchSelect" required>
                            <option value="">Select Branch</option>
                            <option value="CSE">CSE</option>
                            <option value="ECE">ECE</option>
                            <option value="EEE">EEE</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="attendanceDate">Date</label>
                        <input type="date" id="attendanceDate" required>
                    </div>
                    <button type="submit" class="submit-btn">Start Attendance</button>
                </form>
            </div>

            <div id="attendanceTableContainer" style="display: none;">
                <h3>Mark Attendance</h3>
                <table class="course-table">
                    <thead>
                        <tr>
                            <th>Student ID</th>
                            <th>Name</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="attendanceTableBody"></tbody>
                </table>
                <button class="submit-btn" onclick="submitAttendance()">Submit Attendance</button>
            </div>

            <!-- Attendance Percentage Section -->
            <div class="form-container" style="margin-top: 20px;">
                <h3>Check Attendance Percentage</h3>
                <form id="attendanceCheckForm">
                    <div class="form-group">
                        <label for="checkCourseSelect">Course</label>
                        <select id="checkCourseSelect" required>
                            <option value="">Select Course</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="checkSemesterSelect">Semester</label>
                        <select id="checkSemesterSelect" required>
                            <option value="">Select Semester</option>
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                            <option value="6">6</option>
                            <option value="7">7</option>
                            <option value="8">8</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="checkBranchSelect">Branch</label>
                        <select id="checkBranchSelect" required>
                            <option value="">Select Branch</option>
                            <option value="CSE">CSE</option>
                            <option value="ECE">ECE</option>
                            <option value="EEE">EEE</option>
                        </select>
                    </div>
                    <button type="submit" class="submit-btn">Check Attendance</button>
                </form>
                <div id="attendancePercentageContainer" style="display: none;">
                    <h3>Attendance Percentage</h3>
                    <table class="course-table">
                        <thead>
                            <tr>
                                <th>Student ID</th>
                                <th>Name</th>
                                <th>Percentage</th>
                            </tr>
                        </thead>
                        <tbody id="attendancePercentageTable"></tbody>
                    </table>
                </div>
            </div>

            <!-- Modified Attendance History Section -->
            <div class="form-container" style="margin-top: 20px;">
                <h3>Attendance History</h3>
                <form id="historyForm">
                    <div class="form-group">
                        <label for="historyCourseSelect">Course</label>
                        <select id="historyCourseSelect" required>
                            <option value="">Select Course</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="historySemesterSelect">Semester</label>
                        <select id="historySemesterSelect" required>
                            <option value="">Select Semester</option>
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                            <option value="6">6</option>
                            <option value="7">7</option>
                            <option value="8">8</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="historyBranchSelect">Branch</label>
                        <select id="historyBranchSelect" required>
                            <option value="">Select Branch</option>
                            <option value="CSE">CSE</option>
                            <option value="ECE">ECE</option>
                            <option value="EEE">EEE</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="historyType">History Type</label>
                        <select id="historyType" required>
                            <option value="">Select Type</option>
                            <option value="studentId">By Student ID</option>
                            <option value="studentName">By Student Name</option>
                            <option value="date">By Date</option>
                        </select>
                    </div>
                    <div class="form-group" id="studentIdGroup" style="display: none;">
                        <label for="studentIdSelect">Student ID</label>
                        <select id="studentIdSelect">
                            <option value="">Select Student ID</option>
                        </select>
                    </div>
                    <div class="form-group" id="studentNameGroup" style="display: none;">
                        <label for="studentNameSelect">Student Name</label>
                        <select id="studentNameSelect">
                            <option value="">Select Student Name</option>
                        </select>
                    </div>
                    <div class="form-group" id="historyDateGroup" style="display: none;">
                        <label for="historyDate">Date</label>
                        <input type="date" id="historyDate">
                    </div>
                    <button type="submit" class="submit-btn">View History</button>
                </form>
                <div id="historyTableContainer" style="display: none;">
                    <h3>Attendance History</h3>
                    <table class="course-table">
                        <thead id="historyTableHead"></thead>
                        <tbody id="historyTableBody"></tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Modified Announcement Section -->
        <section class="section-container">
            <h2>Class Announcements</h2>
            <div class="form-container">
                <form id="announcementForm">
                    <div class="form-group">
                        <label for="announceCourseSelect">Course</label>
                        <select id="announceCourseSelect" required>
                            <option value="">Select Course</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="announceSemesterSelect">Semester</label>
                        <select id="announceSemesterSelect" required>
                            <option value="">Select Semester</option>
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                            <option value="6">6</option>
                            <option value="7">7</option>
                            <option value="8">8</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="announceBranchSelect">Branch</label>
                        <select id="announceBranchSelect" required>
                            <option value="">Select Branch</option>
                            <option value="CSE">CSE</option>
                            <option value="ECE">ECE</option>
                            <option value="EEE">EEE</option>
                        </select>
                    </div>
                    <div id="announcementDetails" style="display: none;">
                        <div class="form-group">
                            <label for="announcementText">Announcement</label>
                            <textarea id="announcementText" rows="4" required></textarea>
                        </div>
                        <div class="form-group">
                            <label for="announcementFile">Upload Document</label>
                            <input type="file" id="announcementFile" accept=".pdf,.doc,.docx">
                        </div>
                        <button type="submit" class="submit-btn">Announce</button>
                    </div>
                </form>
            </div>
            <div id="announcementHistoryContainer" class="announcement-history" style="display: none;">
                <h3>Announcement History</h3>
                <div id="announcementList"></div>
            </div>
        </section>
    </main>
</div>

<script>
// Hardcoded data
const courses = [
    { code: "CS101", name: "Data Structures", semester: "3", branch: "CSE", strength: 60, room: "A-101" },
    { code: "EC201", name: "Digital Electronics", semester: "4", branch: "ECE", strength: 55, room: "B-202" },
    { code: "EE301", name: "Power Systems", semester: "5", branch: "EEE", strength: "50", room: "C-303" }
];

const students = [
    { id: "CSE001", name: "John Doe", course: "CS101", semester: "3", branch: "CSE" },
    { id: "CSE002", name: "Jane Smith", course: "CS101", semester: "3", branch: "CSE" },
    { id: "ECE001", name: "Alice Brown", course: "EC201", semester: "4", branch: "ECE" },
    { id: "EEE001", name: "Bob Wilson", course: "EE301", semester: "5", branch: "EEE" },
    { id: "EEE001", name: "Bob Wilson donanbajuhxvbcvbwliucvlwiefvcwbcfiubiacb wqdbwuidbwxnbjwjb xcwbd", course: "EE301", semester: "5", branch: "EEE" }
];

let attendanceRecords = [
    { studentId: "CSE001", course: "CS101", date: "2025-05-15", status: "Present" },
    { studentId: "CSE002", course: "CS101", date: "2025-05-15", status: "Absent" },
    { studentId: "CSE001", course: "CS101", date: "2025-05-16", status: "Present" },
    { studentId: "CSE002", course: "CS101", date: "2025-05-16", status: "Present" },
    { studentId: "ECE001", course: "EC201", date: "2025-05-15", status: "Absent" },
    { studentId: "EEE001", course: "EE301", date: "2025-05-15", status: "Present" }
];

let announcements = [
    { course: "CS101", semester: "3", branch: "CSE", text: "Midterm exam scheduled for next week", date: "2025-05-15", file: null }
];

// Sidebar toggle
document.getElementById('menuToggle').addEventListener('click', () => {
    document.getElementById('sidebar').classList.toggle('show');
});

// Populate course table
function populateCourseTable() {
    const tbody = document.getElementById('courseTableBody');
    tbody.innerHTML = '';
    courses.forEach(course => {
        const row = document.createElement('tr');
        row.innerHTML = `
            <td>${course.code}</td>
            <td>${course.name}</td>
            <td>${course.semester}</td>
            <td>${course.branch}</td>
            <td>${course.strength}</td>
            <td>${course.room}</td>
        `;
        tbody.appendChild(row);
    });
}

// Populate course select options
function populateCourseSelects() {
    const selects = [
        document.getElementById('courseSelect'),
        document.getElementById('checkCourseSelect'),
        document.getElementById('announceCourseSelect'),
        document.getElementById('historyCourseSelect')
    ];
    selects.forEach(select => {
        select.innerHTML = '<option value="">Select Course</option>';
        courses.forEach(course => {
            select.innerHTML += `<option value="${course.code}">${course.name} (${course.code})</option>`;
        });
    });
}

// Function to toggle announcement details and history visibility
function toggleAnnouncementDetails() {
    const course = document.getElementById('announceCourseSelect').value;
    const semester = document.getElementById('announceSemesterSelect').value;
    const branch = document.getElementById('announceBranchSelect').value;
    const announcementDetails = document.getElementById('announcementDetails');
    const announcementHistoryContainer = document.getElementById('announcementHistoryContainer');

    if (course && semester && branch) {
        announcementDetails.style.display = 'block';
        announcementHistoryContainer.style.display = 'block';
        renderAnnouncements(course, semester, branch);
    } else {
        announcementDetails.style.display = 'none';
        announcementHistoryContainer.style.display = 'none';
    }
}

// Add event listeners for announcement dropdowns
document.getElementById('announceCourseSelect').addEventListener('change', toggleAnnouncementDetails);
document.getElementById('announceSemesterSelect').addEventListener('change', toggleAnnouncementDetails);
document.getElementById('announceBranchSelect').addEventListener('change', toggleAnnouncementDetails);

// Attendance form submission
document.getElementById('attendanceForm').addEventListener('submit', (e) => {
    e.preventDefault();
    const course = document.getElementById('courseSelect').value;
    const semester = document.getElementById('semesterSelect').value;
    const branch = document.getElementById('branchSelect').value;
    
    const filteredStudents = students.filter(student => 
        student.course === course && 
        student.semester === semester && 
        student.branch === branch
    );

    const tbody = document.getElementById('attendanceTableBody');
    tbody.innerHTML = '';
    filteredStudents.forEach(student => {
        const row = document.createElement('tr');
        row.innerHTML = `
            <td>${student.id}</td>
            <td>${student.name}</td>
            <td>
                <button onclick="markAttendance('${student.id}', 'Present')" class="attendance-btn present-btn">Present</button>
                <button onclick="markAttendance('${student.id}', 'Absent')" class="attendance-btn absent-btn">Absent</button>
            </td>
        `;
        tbody.appendChild(row);
    });

    document.getElementById('attendanceTableContainer').style.display = 'block';
});

// Mark attendance
function markAttendance(studentId, status) {
    const buttons = document.querySelectorAll(`#attendanceTableBody button`);
    buttons.forEach(btn => {
        if (btn.parentElement.parentElement.children[0].textContent === studentId) {
            btn.style.backgroundColor = status === 'Present' ? '#28a745' : '#dc3545';
            btn.style.color = 'white';
        }
    });
}

// Submit attendance
function submitAttendance() {
    const course = document.getElementById('courseSelect').value;
    const date = document.getElementById('attendanceDate').value;
    const rows = document.querySelectorAll('#attendanceTableBody tr');
    
    rows.forEach(row => {
        const studentId = row.children[0].textContent;
        const status = row.querySelector('.present-btn').style.backgroundColor === 'rgb(40, 167, 69)' ? 'Present' : 'Absent';
        attendanceRecords.push({ studentId, course, date, status });
    });

    alert('Attendance submitted successfully!');
    document.getElementById('attendanceTableContainer').style.display = 'none';
    document.getElementById('attendanceForm').reset();
}

// Check attendance percentage
document.getElementById('attendanceCheckForm').addEventListener('submit', (e) => {
    e.preventDefault();
    const course = document.getElementById('checkCourseSelect').value;
    const semester = document.getElementById('checkSemesterSelect').value;
    const branch = document.getElementById('checkBranchSelect').value;

    const filteredStudents = students.filter(student => 
        student.course === course && 
        student.semester === semester && 
        student.branch === branch
    );

    const tbody = document.getElementById('attendancePercentageTable');
    tbody.innerHTML = '';
    filteredStudents.forEach(student => {
        const studentRecords = attendanceRecords.filter(record => record.studentId === student.id && record.course === course);
        const totalDays = studentRecords.length;
        const presentDays = studentRecords.filter(record => record.status === 'Present').length;
        const percentage = totalDays > 0 ? ((presentDays / totalDays) * 100).toFixed(2) : 0;
        const row = document.createElement('tr');
        row.innerHTML = `
            <td>${student.id}</td>
            <td>${student.name}</td>
            <td style="color: ${percentage < 75 ? 'red' : 'green'}">${percentage}%</td>
        `;
        tbody.appendChild(row);
    });

    document.getElementById('attendancePercentageContainer').style.display = 'block';
});

// Attendance history
document.getElementById('historyCourseSelect').addEventListener('change', updateStudentOptions);
document.getElementById('historySemesterSelect').addEventListener('change', updateStudentOptions);
document.getElementById('historyBranchSelect').addEventListener('change', updateStudentOptions);

function updateStudentOptions() {
    const course = document.getElementById('historyCourseSelect').value;
    const semester = document.getElementById('historySemesterSelect').value;
    const branch = document.getElementById('historyBranchSelect').value;

    const filteredStudents = students.filter(student => 
        student.course === course && 
        student.semester === semester && 
        student.branch === branch
    );

    const studentIdSelect = document.getElementById('studentIdSelect');
    const studentNameSelect = document.getElementById('studentNameSelect');

    studentIdSelect.innerHTML = '<option value="">Select Student ID</option>';
    studentNameSelect.innerHTML = '<option value="">Select Student Name</option>';

    filteredStudents.forEach(student => {
        studentIdSelect.innerHTML += `<option value="${student.id}">${student.id}</option>`;
        studentNameSelect.innerHTML += `<option value="${student.id}">${student.name}</option>`;
    });
}

document.getElementById('historyType').addEventListener('change', (e) => {
    const type = e.target.value;
    document.getElementById('studentIdGroup').style.display = type === 'studentId' ? 'block' : 'none';
    document.getElementById('studentNameGroup').style.display = type === 'studentName' ? 'block' : 'none';
    document.getElementById('historyDateGroup').style.display = type === 'date' ? 'block' : 'none';
});

document.getElementById('historyForm').addEventListener('submit', (e) => {
    e.preventDefault();
    const course = document.getElementById('historyCourseSelect').value;
    const semester = document.getElementById('historySemesterSelect').value;
    const branch = document.getElementById('historyBranchSelect').value;
    const type = document.getElementById('historyType').value;
    const tableHead = document.getElementById('historyTableHead');
    const tableBody = document.getElementById('historyTableBody');
    tableBody.innerHTML = '';

    const filteredStudents = students.filter(student => 
        student.course === course && 
        student.semester === semester && 
        student.branch === branch
    );

    if (type === 'studentId' || type === 'studentName') {
        const studentId = type === 'studentId' 
            ? document.getElementById('studentIdSelect').value 
            : document.getElementById('studentNameSelect').value;

        tableHead.innerHTML = `
            <tr>
                <th>Course</th>
                <th>Date</th>
                <th>Status</th>
            </tr>
        `;
        const records = attendanceRecords.filter(record => 
            record.studentId === studentId && 
            record.course === course
        );
        records.forEach(record => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${record.course}</td>
                <td>${record.date}</td>
                <td>${record.status}</td>
            `;
            tableBody.appendChild(row);
        });
    } else if (type === 'date') {
        const date = document.getElementById('historyDate').value;
        tableHead.innerHTML = `
            <tr>
                <th>Student ID</th>
                <th>Course</th>
                <th>Status</th>
            </tr>
        `;
        const records = attendanceRecords.filter(record => 
            record.date === date && 
            filteredStudents.some(student => student.id === record.studentId) &&
            record.course === course
        );
        records.forEach(record => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${record.studentId}</td>
                <td>${record.course}</td>
                <td>${record.status}</td>
            `;
            tableBody.appendChild(row);
        });
    }

    document.getElementById('historyTableContainer').style.display = 'block';
});

// Announcement form submission
document.getElementById('announcementForm').addEventListener('submit', (e) => {
    e.preventDefault();
    const course = document.getElementById('announceCourseSelect').value;
    const semester = document.getElementById('announceSemesterSelect').value;
    const branch = document.getElementById('announceBranchSelect').value;
    const text = document.getElementById('announcementText').value;
    const file = document.getElementById('announcementFile').files[0];
    const date = new Date().toISOString().split('T')[0];

    announcements.push({ course, semester, branch, text, date, file: file ? file.name : null });
    renderAnnouncements(course, semester, branch);
    document.getElementById('announcementText').value = '';
    document.getElementById('announcementFile').value = '';
    alert('Announcement posted successfully!');
});

// Render announcements with filtering
function renderAnnouncements(courseFilter, semesterFilter, branchFilter) {
    const list = document.getElementById('announcementList');
    list.innerHTML = '';
    const filteredAnnouncements = announcements.filter(announcement =>
        announcement.course === courseFilter &&
        announcement.semester === semesterFilter &&
        announcement.branch === branchFilter
    );
    filteredAnnouncements.forEach(announcement => {
        const courseDetails = courses.find(course => course.code === announcement.course);
        const courseDisplay = courseDetails ? `${courseDetails.name} (${announcement.course})` : announcement.course;
        const div = document.createElement('div');
        div.className = 'announcement-item';
        div.innerHTML = `
            <p><strong>${announcement.date}</strong> - ${courseDisplay} (${announcement.semester}, ${announcement.branch})</p>
            <p>${announcement.text}</p>
            ${announcement.file ? `<p><a href="#" class="announcement-file">Download: ${announcement.file}</a></p>` : ''}
        `;
        list.appendChild(div);
    });
}

// Initialize
document.addEventListener('DOMContentLoaded', () => {
    populateCourseTable();
    populateCourseSelects();
});
</script>
</body>
</html>